# О Nuvotion n76e003

Очень простой x51 копеечный микроконтроллер, делался китайцами как замена stm8s003, а потому во многом на него похож... даже расположением выводов.
В отличие от stm8s003 имеет второй UART, лишнюю свободную ногу (можно считать даже 2), в 2 раза больше FLASH (EEPROM разшарен с FLASH), больше (8) каналов ADC [0...4095], и PWM с собственным таймером [0...2047].
Прошивается с помощью программатора NuLink - недорогого, и их полно на Ali. Замечен глюк, который при подключенном программаторе перезагружает контроллер, выполняющий свою программу. Так что, в программе программатора, надо нажимать после загрузки Disconnect.
В общем ничего особенного. Просто рабочая лошадка. Для поделок вполне сойдет.

# О реализации

Библиотека подразумевает работу контроллера от встроенного генератора без внешнего кварца с частотой 16MHz.
Библиотека использует `Timer0` для `delay()`, `millis()`, `micros()` и других функций связанных с временем. Минимальный квант времени 10 мкс. `Timer1` используется для работы `UART0 (Serial0)`, а `Timer3` для `UART1 (Serial1)`. Максимальная поддерживаемая скорость передачи через `Serial0` - `57600`, через `Serial1` - `115200` и вообще точность устанавливаемой скорости у Serial1 выше. Чтобы использовать большие скорости на UART0 нужно использовать внешний кварц на 16600 МГц. Я не стал на это расчитывать. `Timer2` - свободен.
Для вывода в `SerialX` используется функция `SerialXPrintf("строка формата %d 0x%x\n", var1, var2);`. Поддерживаются модификаторы `%d` - десятичное целое, `%x` - шестнадцатеричное, `%o` - восьмиричное, `%c` - символ, `%s` - строка. Для 8 битных чисел при передаче в строку параметров преобразуйте их к 16 битным - `(int)var8bit`. Для 32 битных чисел есть соответствующие модификаторы: `%ld`,`%lx`,`lo`. Строка может выводится просто как `SerialPrint("строка\n");`. Старайтесь не передавать в `SerialXPrintf` много параметров, стэк в контроллере невелик, лучше вызовите функцию несколько раз.
Поддерживаются `pinMode(PIN,mode)`, `digitalRead(PIN)`, `digitalWrite(PIN,value)`. Обратите внимание что цифровой пин имеет формат записи: `D{номер порта}{номер пина}`. Какие пины существуют для данного контроллера можно посмотреть в `gpio.h`.
Поддерживается `analogRead(PIN)`, естественно только на тех ногах `A{номер порта}{номер пина}` на которых он доступен. Необходимо использовать `pinMode(Axx,INPUT)`. Диапазон преобразования [0...Vcc] -> `[0..4095]`.
Поддерживается `analogWrite(PIN,value)`, также только для тех ног которые его поддерживают `PWM{номер порта}{номер пина}`. Необходимо использовать `pinMode(PWMxx,OUTPUT)`. Частота PWM установлена примерно в `2кГц`, диапазон уровней `[0..2047]` -> [0..Vcc].

